<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>收货信息</title>
    <link rel="stylesheet" type="text/css" href="css/weui.css" />
    <link rel="stylesheet" type="text/css" href="css/public.css" />
    <link rel="stylesheet" type="text/css" href="css/mall.css" />
</head>
<body style="background:#f6f6f6;" >
    <div class="container">
        <div class="head">
            <div class="head_navbar">
                <div class="head_navbar_left">
                    <a href="javascript:;" class="w-h-35" onClick="javascript :history.back(-1);"><i class="back_before"></i></a>
                </div>
                <div class="head_navbar_item">收货信息</div>
            </div>
            <div class="head_navbar_r save">
              
            </div>
        </div>
        <div class="rec_info" style="border-top:0;">
            <div class="weui-cells weui-cells_form">
                <div class="weui-cell pad_15">
                    <div class="weui-cell__hd"><label class="weui-label">收货人：</label></div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" placeholder="" id = "name">
                    </div>
                </div>
                <div class="weui-cell pad_15">
                    <div class="weui-cell__hd"><label class="weui-label">联系电话 :</label></div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="number" id = "phone">
                    </div>
                </div>
                 <div class="weui-cell pad_15">
                 	<div id = "position" style="width: 100%;">
							<div><span style="width: 100%;">省份: <select id = "province" name = "province" onchange = "selectProvince()" style="margin-left: 7.6%;width: 75%;"></select></span></div>
	                		<div><span style="width: 100%;">城市: <select id = "city" name = "city" onchange = "selectCity()" style="margin-left: 7.6%;width: 75%;"></select></span></div>
	                		<div><span style="width: 100%;">镇(街道): <select id = town name = "town"  style="width: 75%;"></select></span></div>
					</div> 
				</div>
                <div class="weui-cell pad_15">
                    <div class="weui-cell__hd"><label class="weui-label">收货地址 :</label></div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" id = "address_other">
                    </div>
                </div>
            </div>
        </div>
        <div>
        	<input type = "button" onclick = "submitPosition()" value = "保存" style = "margin: 5px; border: 1px solid; margin-left: 15%; padding: 5px 100px; background-color: #ff7f27;">
        </div>
       
    </div>
     <script type="text/javascript" src="js/jquery.min.js"></script>
     <script type="text/javascript" src="common/common.js"></script>
    <script type="text/javascript">
    /***************初始化修改地址 **************************/
  	var orderId = null;
    $(function(){
	    	//清楚已存地址信息  
	    	$("#name").val();
	    	$("#phone").val();
	    	$("#address_other").val();
    	 var str = location.search;
  	 	 var idAll = str.split('=')[1];
  	 	 if(idAll.search("orderId"==-1)){
  	 		 //修改地址 
	  	 	 var id = idAll.split("&")[0];
	 		 var addressLevel1Id = idAll.split("&")[1];
	 		 var addressLevel2Id = idAll.split("&")[2];
	 		 orderId = idAll.split("&")[3];
  	 		 queryAddress(id);
  	 		 queryAdministrativeRgion(addressLevel1Id,addressLevel2Id);
  	 	 }else{
  	 		 //新增地址 
  	 		 orderId = idAll;
  	 		 queryAdministrativeRgion(null,null);
  	 	 }
    });
	
    
    /********查询城市  **************/
    function queryAdministrativeRgion(addressLevel1Id,addressLevel2Id){
    	var url = "/"+getRoot()+"/ins/DAR/queryPCT";
    	var params = {};
    	params.addressLevel1Id = addressLevel1Id;
    	params.addressLevel2Id = addressLevel2Id;
    	$.ajax({
	         type: "post",
	         url: url,
	         data: params,
	         success: function(result){
				 if(result.state == 0){
					setAdministrativeRegion(result.data);
				 }else{    					
					 location.href = "problem.html?message = "+""+result.message;
				 }           	 
	         }
	     });
    }
    
    
    /*******设置的城市***************/
    function setAdministrativeRegion(){
    	
    }
    
    /*******省份改变 ******************/
    function selectProvince(){
    	var  addressLevel1Id = $("#province").val();
    	queryAdministrativeRgion(addressLevel1Id,null);
    }
    
    /************城市改变 ****************/
    function selectCity(){
    	var  addressLevel1Id = $("#city").val();
    	queryAdministrativeRgion(null,addressLevel2Id);
    }
    
    /*****查询要修改的地址 **********/
    function queryAddress(id){
    	var url = "/"+getRoot()+"/ins/drtShopAddress/queryAddressList";
    	var params = {};
    	params.id = id;
    	params.addressLevel1Id = addressLevel1Id;
    	params.addressLevel2Id = addressLevel2Id;
    	$.ajax({
	         type: "post",
	         url: url,
	         data: params,
	         success: function(result){
				 if(result.state == 0){
					 setPositionInfo(result.data);
				 }else{    					
					 location.href = "problem.html?message = "+""+result.message;
				 }           	 
	         }
	     });
    }
    function setPositionInfo(result){
    	for(var i = 0 ;i< result.length;i++){
	    	$("#name").val(result[i].name);
	    	$("#phone").val(result[i].phone);
	    	$("#province").val(result[i].addressLevel1);
	    	$("#city").val(result[i].addressLevel2);
	    	$("#address_other").val(result[i].addressOther);
	    	$(".container").data("id",result[i].id);
    	}
    }
    /************保存地址 *************************/
    function submitPosition(){
    	var url = "/"+getRoot()+"/ins/drtShopAddress/updateAddress";
		var params = {};
		params.id = $(".container").data("id");
 		params.name = $("#name").val();
 		params.phone = $("#phone").val();
 		params.addressLevel1 = $("#province").val();
 		params.addressLevel2 = $("#city").val();
 		params.addressOther = $("#address_other").val();
 		 $.ajax({
 	         type: "post",
 	         url: url,
 	         data: params,
 	         success: function(result){
 				 if(result.state == 0){
 					backOrderDetail();
 					//location.href = "orderGoods/problem.html?message="+""+result.message;
				 }else{    					
					 location.href = "orderGoods/problem.html?message="+""+result.message;
 				 }           	 
 	         }
 	     });
    }
    
    /**************返回订单页面 **********/
    function backOrderDetail(){
  	        return location.href="orderGoods/order_detail.html?orderId="+orderId+"&orderState";
    }
    </script>
</body>
</html>