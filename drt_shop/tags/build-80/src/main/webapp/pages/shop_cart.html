<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>购物车</title>
    <link rel="stylesheet" type="text/css" href="../css/weui.css" />
    <link rel="stylesheet" type="text/css" href="../css/public.css" />
    <link rel="stylesheet" type="text/css" href="../css/mall.css" />
</head>
<body style="background:#f6f6f6;">
    <div class="container">
        <div class="head">
            <div class="head_navbar"  style = "background-color: #184f84;color:white">
                <div class="head_navbar_left">
                    <a class="w-h-35" href="javascript:;" onClick="javascript :history.back(-1);"><i class="back_before"></i></a>
                </div>
                <div class="head_navbar_item">购物车</div>
                <div class="head_navbar_r">
                    <a id="js" style="color:#b2b2b2" onclick="qjs()">去结算</a>
                </div>
            </div>
        </div>
        
        <div class="look_title" style="display:none" id="logindiv"> 
            <i></i>
            <span id="info"></span>
        </div>
        <div id="shopcat">
	        <div class="weui-tabbar" id="headone">
	            <!-- <a href="mall_index.html" class="weui-tabbar__item">
	                <img src="css/img/index_icon1.png"alt="" class="weui-tabbar__icon">
	                <p class="weui-tabbar__label">主页</p>
	            </a>
	            <a href="shop_cart.html" class="weui-tabbar__item weui-bar__item_on">
	                <img src="css/img/shop_icon2.png" alt="" class="weui-tabbar__icon">
	                <p class="weui-tabbar__label">购物车</p>
	            </a>
	            <a href="me.html" class="weui-tabbar__item">
	                <img src="css/img/order_icon1.png" alt="" class="weui-tabbar__icon">
	                <p class="weui-tabbar__label">我</p>
	            </a> -->
	        </div> 
	        <div style="height:80px;"></div>
	        <div class="js_dialog" id="iosDialog1" style="opacity: 1; display:none;">
	            <div class="weui-mask"></div>
	            <div class="weui-dialog">
	                <div class="weui-dialog__bd">确定删除该宝贝么？</div>
	                <div class="weui-dialog__ft">
	                    <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">取消</a>
	                    <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">确定</a>
	                </div>
	            </div>
	        </div>
	    </div>
    </div>
    <script type="text/javascript" src="../js/jquery.min.js"></script>
      <script type="text/javascript" src="../common/common.js"></script>
    <script type="text/javascript">
         $(function(){
        	 queryShopCar();
            });
         var ctx=getRootPath();
         var cartShops=0;
        function queryShopCar(){
        	$.ajax({
				url : ctx+'/ins/drtShopCart/queryShooCars',
				// data: {userId:selectContent[0].userId},
				//data : data,
				type : "POST",
				//traditional : true,
				success : function(result) {
					 if(result=="-1"){
	    	     			$("#shopcat").hide();
	    	     			$("#js").hide();
	    	     			$("#logindiv").show();
	    	     			$("#info").html("请登录！");
	    	     			return;
	    	     		}
					 cartShops=result.length;
					if(result!=null&&result.length>0){
						for(var i=0;i<result.length;i++){
			        		 var  html="<div class='shop_goods_item clear'>"+
			                 "<div class='detail clear'>"+
			                 "<a href='orderGoods/goods_detail.html?id="+result[i].id+"' class='detail_mask'></a>"+
			                 "<div class='goods_pic'>"+
			                     "<img src='"+fileServer+result[i].itemPicture+"' width='100%' alt='' />"+
			                 "</div>"+
			                 "<div class='goods_con'>"+
			                     "<p class='tit'>"+result[i].itemName+"</p>"+
			                     "<div class='price clear'>"+
			                         "<div class='rmb'>"+
			                             "<p><span class='num'>¥</span>"+result[i].itemEarnings/100+"</p>"+
			                         "</div>"+
			                     "</div>"+
			                 "</div>"+
			                 ' <div class="buy_num">x'+result[i].itemNum+'</div>'+
			            " </div>"+
			             "<a href='javascript:;' class='dele_goods'>"+
			                 "<i></i>"+
			                 "<span>删除</span>"+
			             "</a>"+
			         " <input type='hidden' id='shopid'"+i+" name='shopid' value='"+result[i].id+"'/></div>"
			        		$("#headone").before(html); 
			        	}

		                $(".dele_goods").on("click",function(){
		                    var _this=this
		                    $("#iosDialog1").css("display","block");
		                    // 点击确定时-------------
		                    $(".weui-dialog__btn_primary").on("click",function(){
		                        $(_this).parents(".shop_goods_item").remove();
		                        $("#iosDialog1").css("display","none");
		                        var id=$(_this).next("input").val();
		                        var ids = new Array();
		                        ids[0]=id;
		                        var data={};
		                    	data.ids=ids;
		                    
		                         $.ajax({
		            				url : ctx+'/ins/drtShopCart/delShop',
		            				// data: {userId:selectContent[0].userId},
		            				data : data,
		            				type : "POST",
		            				traditional : true,
		            				success : function(result) {
		            					queryShopCar();
		            				}
		                        }); 
		                    })
		                    // 点击取消时-------------
		                    $(".weui-dialog__btn_default").on("click",function(){
		                        $("#iosDialog1").css("display","none");
		                    })
		                });
						
					}
				}
			});
        }
        
        function qjs(){
        	if(cartShops==0){
        		Toast("请前往商城选购！",2000);
        		return;
        	}
        	location.href="orderGoods/show_order.html";
        }
    </script>
</body>
</html>