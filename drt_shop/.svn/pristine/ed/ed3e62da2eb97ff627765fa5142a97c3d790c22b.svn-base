<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport"
	content="width=device-width,initial-scale=1,user-scalable=0">
<title>订单详情</title>
<link rel="stylesheet" type="text/css" href="../../css/weui.css" />
<link rel="stylesheet" type="text/css" href="../../css/public.css" />
<link rel="stylesheet" type="text/css" href="../../css/mall.css" />
<link rel="stylesheet" type="text/css" href="../../css/orderDetail.css" />
<link rel="stylesheet" type="text/css"
	href="../../css/bootstrap.min.css" />
<style type="text/css">
.weui-cell__hd label {
	float: left;
}

.weui-cell__bd {
	display: none;
}

.container {
	padding-right: 0;
	padding-left: 0;
	margin-right: auto;
	margin-left: auto;
}

html {
	font-size: inherit;
}
.head_navbar_left a i{border-top: 2px solid #f4f4f4;border-left: 2px solid #f4f4f4;}
</style>
</head>
<body style="background: #f6f6f6;">
	<!-- <header class="mui-bar mui-bar-nav">
		<a href="main.html" class="mui-icon mui-icon-left-nav mui-pull-left"></a>
	    <h1 class="mui-title">订单详情</h1>
	    <a href="javascript:;"><span class="mui-icon  mui-pull-right" onclick="goToMall()" style="font-size: smaller;color: white;margin-top:5px;">商城</span></a>
	</header> -->
	<div class="container">
		<div class="head">
			<div class="head_navbar"
				style="background-color: #184f84; color: white">
				<div class="head_navbar_left">
					<a class="w-h-35" href="javascript:;"
						onClick="javascript :history.back(-1);"><i class="back_before"></i></a>
				</div>
				<div class="head_navbar_item">
					<span style="text-align: center; margin-left: 30%;font-size: 17px;">订单详情</span> <input
						type="button" value="商城" onclick="goToMall()"
						style="background-color: #184f84; color: white; margin-left: 20%;font-size: 17px;">
				</div>
			</div>
		</div>
		<div class="look_title" style="display: none" id="logindiv">
			<i></i> <span id="info"></span>
		</div>
		<div id="shopid">
			<div class="order_state_wrap">
				<!-- 地址区 -->
				<div class="rec_info" style="border-bottom: 5px solid #dedede;">
					<div class="weui-cells weui-cells_form">
						<div
							style="width: 5%; float: left; margin-top: 1rem; text-align: right">
							<span><a href="#"><span style="font-size: 20px"
									class="glyphicon glyphicon-map-marker"></span></a></span>
						</div>
						<div style="width: 90%; float: left">
							<div
								style="margin: 5px 10px; font-size: 17px; width: 90%; float: none">
								<div style="float: left">
									收货人：<span id="name"></span>
								</div>
								<div style="float: right; text-align: right">
									<span id="phone"></span>
								</div>
							</div>
							<br>
							<div style="margin: 5px 10px; font-size: 14px; float: none">
								收货地址：<span id="address_other"></span>
							</div>
						</div>
					</div>
					<div id="colorChange"></div>
				</div>
				<!--店铺  -->
				<div class="order_state" style="border-top: 0;">
					<lable id ="shopName" ></lable>
					<span class="status" id="orderState"></span>
				</div>
				<!-- 购买商品展示区 -->
				<div id="shopGoodsDetail"></div>
			</div>
		        <!--信息区  -->
		        <div class = "main_panel" >
		        	<div class = "main_panel_info" >
		        		<div class = "panel_title" >兑换优惠：<input  type = "button" style = "color:red" id = "preferential" value ="包邮"></div>
		        	</div>
		        	<div class = "main_panel_info">
		        		<div class = "panel_title" >配送方式：<input  type = "button" style = "color:red"  id = "send" value = "快递 "></div>
		        	</div>
		        	<div class = "main_panel_info">
		        		<div class = "panel_title" >买家留言：<input  type = "button" id = "orderMemberMemo" value = ""></div>
		        	</div>
					<div class="main_panel_info">
						<div class="panel_title">
							订单总积分：<span class="totalPoint" id="totalPoint"></span>
						</div>
					</div>
					<div class="main_panel_info">
						<span class="order_num" id="orderNum"></span></br>
						<span id="createTime"></span>
					</div>
		        </div>
			<div style="height: 80px;"></div>
			<div class="set_acc clear" id = "operateColumn">
				<div class="set_acc_l">
					合计：<span><span class="num" id="totalMoney"></span> 积分</span>
				</div>
				<span onclick="exchangeGoods()" class="set_acc_r">兑换</span>
			</div>
		</div>
	</div>
	<script type="text/javascript" src="../../js/jquery.min.js"></script>
	<script type="text/javascript" src="../../js/layer/layer.js"></script>
	<script type="text/javascript" src="../../common/common.js"></script>
	<script type="text/javascript" src="../../js/bootstrap.min.js"></script>
	<script type="text/javascript">
         $(function(){
        	getGoodsId();
         });
         
         /*获取订单id     */
       function getGoodsId(){
        	 var str = location.search;
        	 var id = str.split('=')[1];
        	 //if(str.search("orderState")!=-1){//1表示订单是代付款状态 
        		 queryOrderGoods(id.split("&")[0]);
        	 //}
         }
         
      
        /*发送请求，到数据库查找产品信息 */
        var orderId = null;
    	function queryOrderGoods(id){
    		orderId = id;
    		var url = getRootPath()+"/ins/mall/order/queryOrderDetail";
    		var params = {};
    		params.orderId = id;
    		 $.ajax({
    	         type: "post",
    	         url: url,
    	         data: params,
    	         success: function(result){
    				 if(result.state == 0){
    					setOrderGoods(result.data);
 					 }
    	         }
    	     });
    	}
         
       /**显示订单中的商品 */
       var totalMoney = 0;
       function setOrderGoods(result){  
    	   $("#shopName").html(result.storeName)
    	   $("#orderNum").html("订单号："+result.orderCode);
    	   $("#name").html(result.name);
    	   $("#orderState").html(result.orderState);
    	   $("#createTime").html("创建时间："+result.createTime);
    	   $("#orderMemberMemo").val(result.orderMemberMemo);
    	   var deliveryType = result.deliveryType;
    	   if(deliveryType == 1){//1=快递，2=EMS，3=平邮，4=商户自有物流
    		   $("#send").val("快递");
    	   }else if(deliveryType == 2){
    		   $("#send").val("EMS");
    	   }else if(deliveryType == 3){
    		   $("#send").val("平邮");
    	   }else if(deliveryType == 4){
    		   $("#send").val("商户自有物流");
    	   }
    	   var orderState = result.orderState
    	   if(orderState == 1){//1-待付款2-待发货3-已发货4-已完成5-取消订单6-删除订单
    		   $("#orderState").html("待付款");
    	   }else if(orderState == 2){
    		   $("#orderState").html("待发货");
    		   $("#operateColumn").hide();
    	   }else if(orderState == 3){
    		   $("#orderState").html("已发货");
    		   $("#operateColumn").hide();
    	   }else if(orderState == 4){
    		   $("#orderState").html("已完成");
    		   $("#operateColumn").hide();
    	   }else if(orderState == 5){
    		   $("#orderState").html("已取消");
    		   $("#operateColumn").hide();
    	   }
    	   
	    	$("#phone").html(result.phone);
	    	$("#address_other").html(result.address);
	    	$("#totalMoney").html(result.orderTotalEarnings);
	    	$("#totalPoint").html(result.orderTotalEarnings);
    	   var shopGoodsDetail = $("#shopGoodsDetail");
    	   shopGoodsDetail.empty();
    	   var orderDetailList = result.orderDetailList;
    	   for(var i = 0 ;i < orderDetailList.length; i ++){
    		   var panel = '<div class="shop_goods_item clear" data-itemid="'+orderDetailList[i].itemId+'" onclick="goToGoodsDetail(this)" style = "background-color:#f4f4f4"> '+
	               ' <div class="detail clear"> '+
	                   ' <div class="goods_pic">'+
	                    '    <img src="'+orderDetailList[i].imgUrl+'" style = "width: 99%;" alt="" />'+
	                    '</div>'+
	                    ' <span  style = "display:none">'+orderDetailList[i].itemId+'</span> '+
	                    '<div class="goods_con" >'+
	                     '   <p class="tit order_title" id = "idTitle">'+orderDetailList[i].skuName+'</p>'+
	                      '  <div class="price clear">'+
	                       '     <p class="rmb">积分<span class="rmb_num" id = "needPoints">'+orderDetailList[i].skuEarnings+'</span></p>'+
	                        '</div>'+
	                    '</div>'+
	                '</div>'+
	                '<div class="chos_num clear" value = "'+orderDetailList[i].skuEarnings+'">'+
	                ' <span  style = "display:none">'+orderDetailList[i].skuEarnings+'</span> '+
	                '<div class="buy_num">x'+orderDetailList[i].buyAmt+'</div>'+ 
	                '</div>'+
	            '</div>';
	            //subtotalEarnings = orderDetailList[i].subtotalEarnings;
    		   shopGoodsDetail.append(panel);
    	   }
       }
       /***跳转***/
       function goToGoodsDetail(target){
    	   var itemId = $(target).attr("data-itemid");
    	   return location.href="goods_detail.html?id="+itemId;
       }
       
       /**校验地址是否为空 */
       function checkAddress(){
    	   var name = $("#name").html().trim();
    	   if(name==null||name==""){
    		   Toast("收货人姓名不能为空",2000);
    		   return false;
    	   }
	       var phone = $("#phone").html().trim();
	       if(phone == null&&phone==""){
	    	   Toast("收货人联系方式不能为空",2000);
	    	   return false;
	       }
	       var addressOther = $("#address_other").html().trim();
	       if(addressOther == null&&addressOther==""){
	    	   Toast("收货人详细地址不能为空",2000);
	    	   return false;
	       }
	       return true;
       }
       
       /*兑换商品 **/
       function exchangeGoods(){
    	   var checkRegx = checkAddress();
    	   if(!checkRegx){
    		   return;
    	   }
    	   var totalMoney = parseInt($("#totalMoney").html());
    	   var orderNo =  $("#orderNum").html().split(":")[1];
    	   return location.href='payment.html?totalMoney='+totalMoney+'&'+orderId+'&'+orderNo;
       }
       
       /****编辑地址 *********/
       function updatePosition(){
    	   return location.href="../addressList.html?orderId="+orderId+"&";
       }
       
       /**返回首页 **/
   		function goToMall(){
    	   return location.href="main.html";
       }
    </script>
</body>
</html>