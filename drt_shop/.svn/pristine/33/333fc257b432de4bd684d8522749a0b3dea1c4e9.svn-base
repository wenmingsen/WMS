<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
   
    <title>收货信息</title>
    <link rel="shortcut icon" href="../../css/img/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="../../css/weui.css" />
    <link rel="stylesheet" type="text/css" href="../../css/public.css" />
    <link rel="stylesheet" type="text/css" href="../../css/mall.css" />
    <link rel="stylesheet" type="text/css" href="../../css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../../css/mui/mui.min.css" />
    <style>
   	 .container {
	    padding-right: 0;
	    padding-left: 0;
	    margin-right: auto; 
	    margin-left: auto;
	}
	.head_navbar_left a i{border-top: 2px solid #f4f4f4;border-left: 2px solid #f4f4f4;}
	
	.weui-cell{
        border-bottom:1px solid #dedede;
        padding:.85rem;
    }
    .weui-cell:before{
        border-top: 0;
    }
	.modal-footer{
		border:0px solid;
		text-align:center;
	}
	#myModal{
		margin-top:50%;
	}
	.modal-dialog{
		width: 70%;
    	margin-left: 15%;
	}
	.modal-header{
		padding:0px;
		border-bottom:0px solid;
	}
	.modal-body{
		padding:10px;
	}
	.btn-info{
		border:0px solid;
		background-color:red;
	}
	.modal-footer{
		padding:0px;
		color:blue;
	}
	
    </style>
</head>
<body style="background:#f6f6f6;">
    <div class="container">
        <div class="head">
            <div class="head_navbar" style = "background-color: #184f84;color:white">
                <div class="head_navbar_left" id = "backHistory">
                    <a href="javascript:history.go(-1);" class="w-h-35" ><i class="back_before"></i></a>
                </div>
                <div class="head_navbar_item"><span style = "text-align:center;margin-left:12%;font-size: 17px;">地址列表</span>
                	<span class="mui-icon mui-icon-plusempty" onclick = "addAddress()" style = "height: 20px;width: 20px; float: right;margin-right: 5%;margin-top: 1px;font-weight: 900;"></span>
                </div>
                <a href = "main.html"><span class="mui-icon mui-icon-home-filled" style = "float: right; padding-right: 18px;color: white;margin-top: 8px;"></span></a>
            </div>
            <div class="head_navbar_r save">
              
            </div>
        </div>
        <div class="rec_info" style="border-top:0;">
            <div class="weui-cells weui-cells_form" id = "addressList">
                <!-- <div class="weui-cell pad_15">
                    <div class="weui-cell__bd">
                    	<div id = "detailAddress" >
                    		收件地址：**********
                    	</div>
                    	<div class = "changeAddressStatus">
                    		<span ><input type = "checkBox" id = "defaultAddress">设置为默认</span>
                    		<input type = "button" value = "修改" id = "updateAddress()" style = "margin-left: 50%;border:1px solid;right:5px;background-color: #ff5001;color:white;padding:2px">
                    		<input type = "button" value = "删除" id = "deleteAddress()" style = "border:1px solid;right:5px;background-color: #ff5001;color:white;padding:2px">
                    	</div>
                    </div>
                </div> -->
                
            <!--     <div class="weui-cell pad_15">
                    <div class="weui-cell__hd"><label class="weui-label">联系电话 :</label></div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="number" id = "phone">
                    </div>
                </div>
                 <div class="weui-cell pad_15">
                 	<div id = "position">
							省份:<select id = "province" name = "province" onchange = "select()" style = "width:90px"></select>
	                		城市:<select id = "city" name = "city" onchange = "select()" style = "width:90px"></select>
					</div> 
				</div>
                <div class="weui-cell pad_15">
                    <div class="weui-cell__hd"><label class="weui-label">收货地址 :</label></div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" id = "address_other">
                    </div>
                </div> -->
            </div>
        </div>
    </div>
    
    
        
    	<!-- 模态框 -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h3 class="modal-title text-center" id="myModalLabel1" style = " padding-top: 10px;">操作提示</h3>
					</div>
					<div class="modal-body">
						<form id="userAddForm" method="post">
								<div class="tab-pane fade in active"  style = "text-align:center">
										<p>确认删除吗？</p>
								</div>
						</form>	
				</div>
				<div class="modal-footer" style = "border-top:1px solid #dedede;">
					<div   onclick="submit1()" style = "width:50%;float:left;text-align:center;padding: 15px; border-right: 1px solid #dedede;" data-dismiss="modal">  
                       	<b>是</b>  
                   	</div>
                   	<div   style = "width:50%;float:right;text-align:center;padding: 15px;" data-dismiss="modal">  
                       	<b>否</b>  
                   	</div>
				</div>
			</div>
			<!-- /.modal-content -->
		</div>
		<!-- /.modal -->
</div>
 
    
     <script type="text/javascript" src="../../js/jquery.min.js"></script>
     <script type="text/javascript" src="../../js/layer/layer.js"></script>
     <script type="text/javascript" src="../../js/bootstrap.min.js"></script>
     <script type="text/javascript" src="../../common/common.js"></script>
    <script type="text/javascript">
    
    
    
    	var orderId = null;
    	var strOrderId = null;
    	var items = null;
    	$(function(){
    		 items = sessionStorage.getItem("data");
    		 strOrderId = location.search;
    		 queryAddressList();
    		$(".container").on("click",".defaultAddress",defaultAddress);
   			if(strOrderId.search("backHistory")!=-1){
    			var backHistory = $("#backHistory");
    			backHistory.empty();
    			backHistory.append('<a href="me.html;" class="w-h-35" ><i class="back_before"></i></a>');		
   			}
    		
    	});
    	
    	/******查询所有地址 ********/
    	function queryAddressList(){
    		var url = getRootPath()+"/ins/drtShopAddress/queryAddressList";
    		var params = {};
    		$.ajax({
    	         type: "post",
    	         data:params,
    	         url: url,
    	         success: function(result){
    				 if(result.state == 0){
    					 showAllAddresses(result.data);
	   				 }
    	         }
    	     });    		
    	}
    	
    	
    	setTimeout(function(){
    		queryAddressList();
    	},50);
    	var addressSize = 0;
    	/*******展示所有地址 ********/
    	function showAllAddresses(result){
    		if(result.length!=addressSize){
    			addressSize=result.length;
    		}else{
    			return;
    		}
    		var addressList = $("#addressList");
    		addressList.empty();
    		for(var i = 0; i < result.length; i++){
    			var panel = '<div class="weui-cell pad_15" style = "border-bottom: 5px solid #dadada;">'+
			                    '<div class="weui-cell__bd">'+
					            '		<div id = "getAllInfo" style = "display:none" >'+result[i].addressId+'</div>'+
					            '	<div id = "detailAddress" onclick = "ensureAddress(this)" width = "100%">'+
					            '<div><span>'+result[i].name+'</span><span style = "float:right">'+result[i].phone+'</span></div>'+
					            ' 		<span style = "font-size:14px;">'+result[i].addressLevel1+result[i].addressLevel2+result[i].addressLevel3+result[i].addressOther +'</span>'+
					            '	</div>'+
					            '	<div style = "margin-top: 10px;padding: 10px 0 0 0; border-top: 1px solid #dadada;" class = "changeAddressStatus" >'+
					            '		<span style = "float: left;font-size:15px;"><input type = "checkbox"   name ="radio" class = "defaultAddress"  value = "'+result[i].addressId+'">默认地址</span>'+
					            '<div style = "float: right;">'+
					            '		<a href="#"><span style = "font-size:14px" class="glyphicon glyphicon-pencil"></a><input type = "button" value = "编辑" onclick = "updateAddress(&#39;'+result[i].addressId+'&#39;)" style = "border:0px solid;right:5px;background-color: white;padding:2px;font-size:15px">'+
					            '		<input type="text" value = "'+result[i].addressId+'&'+result[i].addressLevel1Id+'&'+result[i].addressLevel2Id+'&'+result[i].addressLevel3Id+'" style = "display:none">'+
					            '		<a href="#"><span style = "font-size:14px" class="glyphicon glyphicon-trash"></span></a><input type = "button" value = "删除" onclick = "deleteAddress(&#39;'+result[i].addressId+'&#39;)" style = "border:0px solid;right:5px;background-color: white;padding:2px;font-size:15px">'+
					            '</div>'+
					            '	</div>'+
					            '</div>'+
					        '</div>';
				if(result[i].isDefault==0){
					panel = '<div class="weui-cell pad_15" style = "border-bottom: 5px solid #dadada;">'+
			                    '<div class="weui-cell__bd">'+
					            '		<div id = "getAllInfo" style = "display:none" >'+result[i].addressId+'</div>'+
					            '	<div id = "detailAddress" onclick = "ensureAddress(this)">'+
					            '<div><span>'+result[i].name+'</span><span style = "float:right">'+result[i].phone+'</span></div>'+
					            ' 	<span style = "font-size:14px">'+result[i].addressLevel1+result[i].addressLevel2+result[i].addressLevel3+result[i].addressOther +'</span>'+
					            '	</div>'+
					            '	<div style = "margin-top: 10px;padding: 10px 0 0 0;border-top: 1px solid #dadada;" class = "changeAddressStatus" >'+
					            '		<span  style = "float: left;font-size:15px;color:#ff5000"><input type = "checkbox"   checked name ="radio" class = "defaultAddress"  value = "'+result[i].addressId+'">默认地址</span>'+
					            '<div style = "float: right;">'+
					            '	<a href="#"><span style = "font-size:14px" class="glyphicon glyphicon-pencil"></a><input type = "button" value = "编辑" onclick = "updateAddress(&#39;'+result[i].addressId+'&#39;)" style = "border:0px solid;right:5px;background-color: white;padding:2px;font-size:15px">'+
					            '		<input type="text" value = "'+result[i].addressId+'&'+result[i].addressLevel1Id+'&'+result[i].addressLevel2Id+'&'+result[i].addressLevel3Id+'" style = "display:none">'+
					            '	<a href="#" ><span style = "font-size:14px" class="glyphicon glyphicon-trash"></span></a><input type = "button" value = "删除" onclick = "deleteAddress(&#39;'+result[i].addressId+'&#39;)" style = "border:0px solid;right:5px;background-color: white;padding:2px;font-size:15px">'+
					            '</div>'+
					            '	</div>'+
					            '</div>'+
					        '</div>';
				}		        
				addressList.append(panel);
    		}
    	}
    	
    	/*****新增地址 ***********/
    	function addAddress(){
    		return location.href="address.html";
    	}
    	
    	/*****判断从何处来的申请  ******/
    	function ensureAddress(btn){
    		var addressInfo = btn.previousElementSibling.innerHTML;
    		var addressId = addressInfo.split(",")[0];
    		if(items){
    			/*****未提交订单的地址修改 ******/
    			return location.href = "show_order.html?addressId="+addressId;
    		}else{//地址管理处的地址修改 
    			return;
    		}
    	}
    	
    	/*****updateOrderAddress******/
    	function updateOrderAddress(name,phone,addressOther,addressId){
    		var params = {};
    		params.addressId = addressId;
    		params.id = orderId;
    		params.name = name;
    		params.phone = phone;
    		params.address = addressOther;
    		var url = getRootPath()+"/ins/drtShopOrderDetail/updateOrderAddress";
    		$.ajax({
    	         type: "post",
    	         url: url,
    	         data: params,
    	         success: function(result){
    	        	 if(result.state == -1){
    	        		 Toast(result.message,2000);
    	        		 return;
    	        	 }
    	        	 location.href="orderGoods/order_detail.html?orderId="+orderId+"&orderState=1";
    	         }
    	     }); 
    	}
    	
    	/********修改地址 ***************/
    	function updateAddress(addressId){
    		return location.href="address.html?addressId="+addressId;
    	}
    	
    	/************设置默认地址 *****************/
    	function defaultAddress(){
    		var url = getRootPath()+"/ins/drtShopAddress/updateAddress";
    		var params = {};
    		var id = $(this).val();
    		params.addressId = id;
    		if($(this).is(":checked")){
    			params.isDefault = 0;
    		}else{
    			params.isDefault = 1;
    		}
    		var btn = $(this);
    		var allName = document.getElementsByName("radio");
    		for(var i = 0; i <allName.length; i++){
    			allName[i].checked=false;
    			allName[i].parentNode.style.color = 'black';
    		}
    		if(params.isDefault==0){
	    		btn.prop("checked",true);
	    		btn.parent().css({color:'#ff5000'});
    		}
    		 $.ajax({
     	         type: "post",
     	         url: url,
     	         data: params,
     	         success: function(result){
     	        	if(result.state==0){
	    	        	 if(params.isDefault==0){
	    	        		 Toast("设置成功",2000);
	    	        	 }else{
	    	        		 Toast("取消成功",2000);
	    	        	 }
   	        	 	}else{
	   	        	 	if(params.isDefault==0){
		   	        		 Toast("设置失败",2000);
		   	        	 }else{
		   	        		 Toast("取消失败",2000);
		   	        	 }
   	        	 	}
     	         }
     	     });
    	}
    	
    	
    	 function deleteAddress(addressId){
         	$("#myModal").modal();
         	$("#myModal").data("addressId",addressId);
          }
          function submit1(){
        	  goTodeleteAddress($("#myModal").data("addressId"));
          }
    	/********删除地址 ****************/
    	function goTodeleteAddress(addressId){
    		var params = {};
    		params.addressId = addressId;
    		var url = getRootPath()+"/ins/drtShopAddress/deleteAddress";
    		$.ajax({
    	         type: "post",
    	         url: url,
    	         data: params,
    	         success: function(result){
    	        	 if(result.message){
	    	        	 Toast(result.message,2000);
    	        	 }
					if(result.state==0){
						queryAddressList();
					}	
    	         }
    	     }); 
    	}
    	/********返回订单 ***********/
    	/*  function backOrderDetail(){
    	  	     return location.href="orderGoods/order_detail.html?orderId="+orderId+"&orderState";
    	    } */
    	
    </script>
</body>
</html>