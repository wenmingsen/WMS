<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport"
	content="width=device-width,initial-scale=1,user-scalable=0">
<title>商品详情</title>
<link rel="shortcut icon" href="../../css/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" type="text/css" href="../../css/weui.css" />
<link rel="stylesheet" type="text/css" href="../../css/public.css" />
<link rel="stylesheet" type="text/css" href="../../css/mall.css" />
<link rel="stylesheet" type="text/css" href="../../css/mui.min.css" />

<style type="text/css">
p{color:#333;}
.mui-bar {
	background-color: #184f84;
}

.mui-bar .mui-title {
	color: #f4f4f4;
}

.mui-bar .mui-icon {
	color: #f4f4f4;
}
.mui-preview-image.mui-fullscreen {
	position: fixed;
	z-index: 20;
	background-color: #000;
}
.mui-preview-header,
.mui-preview-footer {
	position: absolute;
	width: 100%;
	left: 0;
	z-index: 10;
}
.mui-preview-header {
	height: 44px;
	top: 0;
}
.mui-preview-footer {
	height: 50px;
	bottom: 0px;
}
.mui-preview-header .mui-preview-indicator {
	display: block;
	line-height: 25px;
	color: #fff;
	text-align: center;
	margin: 15px auto 4;
	width: 70px;
	background-color: rgba(0, 0, 0, 0.4);
	border-radius: 12px;
	font-size: 16px;
}
.mui-preview-image {
	display: none;
	-webkit-animation-duration: 0.5s;
	animation-duration: 0.5s;
	-webkit-animation-fill-mode: both;
	animation-fill-mode: both;
}
.mui-preview-image.mui-preview-in {
	-webkit-animation-name: fadeIn;
	animation-name: fadeIn;
}
.mui-preview-image.mui-preview-out {
	background: none;
	-webkit-animation-name: fadeOut;
	animation-name: fadeOut;
}
.mui-preview-image.mui-preview-out .mui-preview-header,
.mui-preview-image.mui-preview-out .mui-preview-footer {
	display: none;
}
.mui-zoom-scroller {
	position: absolute;
	display: -webkit-box;
	display: -webkit-flex;
	display: flex;
	-webkit-box-align: center;
	-webkit-align-items: center;
	align-items: center;
	-webkit-box-pack: center;
	-webkit-justify-content: center;
	justify-content: center;
	left: 0;
	right: 0;
	bottom: 0;
	top: 0;
	width: 100%;
	height: 100%;
	margin: 0;
	-webkit-backface-visibility: hidden;
}
.mui-zoom {
	-webkit-transform-style: preserve-3d;
	transform-style: preserve-3d;
}
.mui-slider .mui-slider-group .mui-slider-item img {
	width: auto;
	height: auto;
	max-width: 100%;
	max-height: 100%;
}
.mui-android-4-1 .mui-slider .mui-slider-group .mui-slider-item img {
	width: 100%;
}
.mui-android-4-1 .mui-slider.mui-preview-image .mui-slider-group .mui-slider-item {
	display: inline-table;
}
.mui-android-4-1 .mui-slider.mui-preview-image .mui-zoom-scroller img {
	display: table-cell;
	vertical-align: middle;
}
.mui-preview-loading {
	position: absolute;
	width: 100%;
	height: 100%;
	top: 0;
	left: 0;
	display: none;
}
.mui-preview-loading.mui-active {
	display: block;
}
.mui-preview-loading .mui-spinner-white {
	position: absolute;
	top: 50%;
	left: 50%;
	margin-left: -25px;
	margin-top: -25px;
	height: 50px;
	width: 50px;
}
.mui-preview-image img.mui-transitioning {
	-webkit-transition: -webkit-transform 0.5s ease, opacity 0.5s ease;
	transition: transform 0.5s ease, opacity 0.5s ease;
}
@-webkit-keyframes fadeIn {
	0% {
		opacity: 0;
	}
	100% {
		opacity: 1;
	}
}
@keyframes fadeIn {
	0% {
		opacity: 0;
	}
	100% {
		opacity: 1;
	}
}
@-webkit-keyframes fadeOut {
	0% {
		opacity: 1;
	}
	100% {
		opacity: 0;
	}
}
@keyframes fadeOut {
	0% {
		opacity: 1;
	}
	100% {
		opacity: 0;
	}
}
p img {
	max-width: 100%;
	height: auto;
}
</style>
</head>
<body style="background: #f6f6f6;">
	<!--  <header class="mui-bar mui-bar-nav">
        	<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" href = "javascript :history.go(-1);"></a>
		    <h1 class="mui-title">商品详情</h1>
		</header> -->
	<header class="mui-bar mui-bar-nav">
		<a href="main.html" class="mui-icon mui-icon-left-nav mui-pull-left"></a>
	    <h1 class="mui-title">商品详情</h1>
	    <a href = "main.html"><span class="mui-icon mui-icon-home-filled" style = "float: right; padding-right: 18px;color: white;"></span></a>
	</header>
	<div id="mainGoods" class="container">
		<!-- <div class="head">
			<div class="head_navbar"
				style="background-color: #184f84;color:white;height:44px;">
				<div class="head_navbar_left">
					<a class="w-h-35" href="javascript:;"
						onClick="javascript :history.back(-1);"><i class="back_before"></i></a>
				</div>
				<div class="head_navbar_item" style="font-size:17px;color:#f4f4f4;font-weight: 500;font-family: 'Helvetica Neue',Helvetica,sans-serif;">商品详情</div>
			</div>
		</div> -->
		<div class="look_title" style="display: none" id="logindiv">
			<i></i> <span id="info"></span>
		</div>
		<div id="shopid">
			<div class="goods_intro">
				<div style="width =: 100%;">
					<div id="slider" class="mui-slider">
						<div class="mui-slider-group mui-slider-loop" id="goodsImg"
							style="width: 100%; padding-bottom: 86%; height: 0; box-sizing: border-box;">

						</div>
						<div class="mui-slider-indicator" id="picturePoint"></div>
					</div>

				</div>
				<div class="intro_detail">
					<p class="intro_name"></p>
					<div class="clear">
						<p style="color: #ff4400; float: left; font-size: 16px;">积分</p>
						<p class="money"></p>
					</div>
					<div class="intro_info"
						style="font-size: 12px; color: #a4a4a4; text-align: center">
						<span id="sendType" style="float: left">快递包邮</span>
						<span>&nbsp;&nbsp;</span>
						<span id="saleNum" style="float: right;margin-right: 10px;">已兑0</span>
					</div>
				</div>
			</div>
			<!--   <div class = "intro_info_time" style = "border-bottom: 1px solid #dedede; background-color: #fff0f5;">
             		<p class = "movement" style = "color:#fe14ad;padding: 10px 13px 5px;">&nbsp;</p>
             </div> -->
			<div class="detail_intro">
				<h2>产品介绍：</h2>
				<p id="goodsDetail"></p>
			</div>
			<div class="detail_production"
				style="padding: 5px 15px 15px 15px; border-top: 1px solid red; border-bottom: 1px solid #dedede; background-color: #ffffff;">
				<h2 style="font-size: 17px; font-weight: normal; color: #333">产品属性：</h2>
				<div id="production" style="text-align: center;"></div>
			</div>
			<div style="height: 80px;">
				<div id="detailPicture" style="padding-bottom: 2.9rem"></div>
			</div>
			<div class="mall-tabbar">
				<a href="#" onclick="goToShopCart()"
					class="mall_tabbar_item sho_tro"> <span
					style="display: inline-block; position: relative;"> <img
						src="../../css/img/shop_icon3.png" alt=""
						class="weui-tabbar__icon"> <span class="weui-badge"
						style="position: absolute; top: -2px; right: -10px;"
						id="countGoods">...</span>
				</span>
					<p class="weui-tabbar__label">购物车</p>
				</a> <span class="mall_tabbar_item join_item">
					<p class="weui-tabbar__label" id="addGoods" onclick="addGoods()">加入购物车</p>
				</span> <span class="mall_tabbar_item buy_item">
					<p class="weui-tabbar__label" id="buyGoods" onclick="buyGoods()">立即兑换</p>
				</span>
			</div>
		</div>
	</div>

</body>

<script type="text/javascript" src="../../js/mui/mui.min.js"></script>
<script src="../../js/mui/mui.zoom.js"></script>
<script src="../../js/mui/mui.previewimage.js"></script>
<script type="text/javascript" src="../../js/jquery.min.js"></script>
<script type="text/javascript" src="../../js/layer/layer.js"></script>
<script type="text/javascript" src="../../common/common.js"></script>
<script type="text/javascript">
	var orderGoods = null;
	$(function() {
		queryOrderGoods();
		countGoods();
	});

	/*轮播图初始化 */
	mui.init({
		swipeBack : true
	//启用右滑关闭功能
	});
	
	mui.previewImage();

	mui("body").on('tap', '.mui-action-back', function() {
		window.history.back();
	})

	/*跳转购物车 **/
	function goToShopCart() {
		return location.href = "shop_cart.html";
	}

	/****统计商品种类数量 *********/
	function countGoods() {
		var url = getRootPath() + "/ins/mall/cart/totalNum";
		$.ajax({
			type : "post",
			url : url,
			success : function(result) {
				if (result == "-1") {
					var str = "<div style='line-height: 50px;text-align: center; background: #eeee;color:#333;'>请先登录</div>";
					$(".mall-tabbar").html(str);
					return;
				}
				if (result.state == 0) {
					if(result.data>9){
						$("#countGoods").html("···");
					}else{
						$("#countGoods").html(result.data);
					}
				}
			}
		});
	}

	/*发送请求，到数据库查找产品信息 */
	function queryOrderGoods() {
		var url = getRootPath() + "/ins/mall/item/item";//drtShopItem/queryOrderGoods";
		var params = {};
		//var str = location.search;
		params.itemId = getUrlParam("id");
		//params.id = "22237f5d6e324033952d96c06c3b6746";//"3ef63ee640bb44988945f0fb3059cddc";//"22237f5d6e324033952d96c06c3b6746";
		$.ajax({
			type : "post",
			url : url,
			data : params,
			success : function(result) {
				// 是否下架
				var isUndercarriage = true;
				if (result.state == 0 && result.data) {
					var data = eval('(' + result.data + ')');
					if (data.skuStatus == 3) {
						isUndercarriage = false;
						setOrderGoods(data);
					}
				}
				if (isUndercarriage) {
					$(".join_item").css("background", "white");
					$("#buyGoods").html("该商品已下架");
					$(".buy_item").css("background", "#dedede");
					$("#addGoods").attr("onclick", "");
					$("#buyGoods").attr("onclick", "");
				}
			}
		});
	}

	/*设置产品详情 */
	function setOrderGoods(data) {
		if (data) {
			$(".intro_name").html(data.skuName);
			$(".money").html(data.skuEarnings);
			$("#goodsDetail").html(data.skuAdword);
			$("#saleNum").html("已兑" + data.exchangeRate);
			setCirclePicture(data.imgList, data.detailDescImgList);
			setSkuProp(data.skuPropList);
		}
	}

	/*设置产品 sku属性 */
	function setSkuProp(data) {
		if (data) {
			var production = $("#production");
			production.empty();
			production
					.append("<div style = 'height:24px;text-overflow: ellipsis; white-space: normal; overflow: hidden;border:1px solid black;'><div style = 'float: left;font-size: 15px; width: 20%; text-align: center;border-right:1px solid;'>名称</div><div style = 'float: left;font-size: 15px; text-overflow:ellipsis;nowrao:false;width: 80%; text-align: center;'>数值</div></div>");
			for (var i = 0; i < data.length; i++) {
				var panel = "<div style = 'height:24px;text-overflow: ellipsis; white-space: normal; overflow: hidden;border-left:1px solid black;border-right:1px solid black;border-bottom:1px solid black;'><div style = 'float: left; font-size: 15px;width: 20%;color: black;border-right:1px solid;'>"
						+ data[i].propName
						+ "</div><div style = 'float: left;font-size: 15px; text-overflow:ellipsis;nowrao:false;width: 80%; color: black;'>"
						+ data[i].propValue + "</div></div>";
				production.append(panel);
			}
		} else {
			$(".detail_production").css("display", "none");
		}
	}

	/*设置轮播图 */
	function setCirclePicture(imgList, detailDescImgList) {
		// 轮播图
		if (imgList && imgList.length > 0) {
			$("#goodsImg").empty();
			$("#goodsImg")
					.append(
							'	<div class="mui-slider-item mui-slider-item-duplicate">'
									+ '		<a href="#">'
									+ '			<img src="'+imgList[imgList.length-1].imgUrl+'" style = "border:0 solid">'
									+ '		</a>' + '	</div>');
			for (var i = 0; i < imgList.length; i++) {
				$("#goodsImg")
						.append(
								'<div class="mui-slider-item">'
										+ '	<a href="#">'
										+ '		<img data-preview-src="" data-preview-group="1" src="'+imgList[i].imgUrl+'" style="border:0 solid">'
										+ '	</a>' + '</div>');
				if (i == 0) {
					$("#picturePoint").append(
							'<div class="mui-indicator mui-active"></div>');
				} else {
					$("#picturePoint").append(
							'<div class="mui-indicator"></div>');
				}
			}
			$("#goodsImg")
					.append(
							'	<div class="mui-slider-item mui-slider-item-duplicate">'
									+ '		<a href="#">'
									+ '			<img src="'+imgList[0].imgUrl+'"  style = "border:0 solid">'
									+ '		</a>' + '	</div>');
			
			//获得slider插件对象
			var gallery = mui('.mui-slider');
			gallery.slider({
			  interval:5000//自动轮播周期，若为0则不自动播放，默认为0；
			});
		}

		// 详情图
		if (detailDescImgList && detailDescImgList.length > 0) {
			$("#detailPicture").empty();
			for (var i = 0; i < detailDescImgList.length; i++) {
				$("#detailPicture")
						.append(
								'<div style = "width:100%;border-bottom:5px solid #dedede"><img data-preview-src="" data-preview-group="2" style="border:0px solid" width = "100%" src = "'
										+ detailDescImgList[i].imgUrl
										+ '"></div>');
			}
		}
	}

	/* 加入购物车  */
	function addGoods() {
		var url = getRootPath() + "/ins/mall/cart/mallCartAddItem";
		var params = {};
		var str = location.search;
		params.itemId = getUrlParam("id");
		$.ajax({
			type : "post",
			url : url,
			data : params,
			success : function(result) {
				if (result.state == 0) {
					Toast("加入成功", 2000);
					var countGoods = parseInt($("#countGoods").html()) + 1;
					if(countGoods<10){
						$("#countGoods").html(countGoods);
					}else{
						$("#countGoods").html("···");
					}
				}
			}
		});
	}

	/*购买商品   */
	function buyGoods() {
		//	var str = location.search;
		var ids = [ 0 ];
		var id = {};
		id.itemId = getUrlParam("id");//"22237f5d6e324033952d96c06c3b6746";//str.split('=')[1];
		id.itemNum = 1;
		ids[0] = id;
		sessionStorage.setItem("ids", JSON.stringify(ids));
		return location.href = 'show_order.html';
	}
	
	mui(".mui-bar-nav").on('tap','.mui-icon-left-nav',function(){
		history.back();
	})
</script>
</html>