<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>购物车</title>
    <link rel="shortcut icon" href="../../css/img/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="../../css/weui.css" />
    <link rel="stylesheet" type="text/css" href="../../css/public.css" />
    <link rel="stylesheet" type="text/css" href="../../css/mall.css" />
	<link rel="stylesheet" type="text/css" href="../../css/mui.min.css" />
	<style>
		.head_navbar_r a{
			top: 10px;
		}
		.mui-bar {
			background-color: #184f84;
		}
		
		.mui-bar .mui-title {
			color: #f4f4f4;
		}
		
		.mui-bar .mui-icon {
			color: #f4f4f4;
		}
	</style>
</head>
<body style="background:#f6f6f6;">
	<header class="mui-bar mui-bar-nav">
		<a href="javascript:;" class="mui-icon mui-icon-left-nav mui-pull-left"></a>
	    <h1 class="mui-title">购物车</h1>
	    <a href="javascript:;"><span class="mui-icon  mui-pull-right" onclick="cz(0)" id="editAll" style="display:none; font-size: smaller;color: #ccc;margin-top:5px;">编辑全部</span></a>
	</header>
    <div class="container">
        <!-- <div class="head">
            <div class="head_navbar"  style = "background-color: #184f84;color:white;height:44px;">
                <div class="head_navbar_left">
                    <a class="w-h-35" href="javascript:;" onClick="fallback()"><i class="back_before"></i></a>
                </div>
                <div class="head_navbar_item" style="font-size:17px;color:#f4f4f4;font-weight: 500;font-family: 'Helvetica Neue',Helvetica,sans-serif;">购物车</div>
                <div class="head_navbar_r">
                    <a href="#" onclick="cz(0)" id="editAll" style="font-size: smaller;color: #ccc">编辑全部</a>
                </div>
            </div>
        </div> -->
        
		<div class="look_title" style="display:none" id="logindiv"> 
            <i></i>
            <span id="info"></span>
        </div>
		
		<div id="shopCat" style = "padding-top: 15px;">
		   
        
        </div> 
        <div id="lookshop"></div>
        <div class="set_acc clear" id="hj" style="display:none">
           <div class="set_acc_l" style="padding-left: 1%">
               <div class="mui-input-row mui-checkbox mui-left">
				  <label style="padding-right: 0%;">全选   <span  style="padding-left:12%;font-size: 14px" id="hjjf"> 合计积分：<span class="zjf" id = "totalMoney">0</span></span> </label>
				  <input name="selectAll" class="select" value="Item 1" type="checkbox" style="top:21%">
			 </div> 
		         
	       </div>
	       <span onclick = "exchangeGoods()" class="set_acc_r">结算(0)</span>
	   </div>
        <div style="height:80px;"></div>
        <div class="js_dialog" id="iosDialog1" style="opacity: 1; display:none;">
            <div class="weui-mask"></div>
            <div class="weui-dialog">
                <div class="weui-dialog__bd">确定删除该宝贝么？</div>
                <div class="weui-dialog__ft">
                    <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">取消</a>
                    <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">确定</a>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="../../js/jquery.min.js"></script>
    <script type="text/javascript" src="../../js/layer/layer.js"></script>
	<script type="text/javascript" src="../../js/mui.min.js"></script>
	 <script type="text/javascript" src="../../common/common.js"></script>
    <script type="text/javascript">
    /* window.onunload=function(){
    	queryShopCar();
    } */
    	// 是否发送同步购物车请求
    	var isSynRequest = false;
        $(function(){
       	   queryShopCar();
        });
        
       
        
        var ctx=getRootPath();
   	   /**查询购物车商品*/
   	   function queryShopCar(){
   		   
   		   $.ajax({
   				url : ctx+'/ins/mall/cart/mallCartDetail',
   				type : "POST",
   				success : function(result) {
   					 $("#shopCat").html("");
   					 if(requestResultDeal(result)){
   						isSynRequest = true;
   						 return;
   					 }else{
   						var stores=result.data;
   	   					if(stores.length==0){
   	   					       	$("#lookshop").append('<div id="noclass" style="width: 100%;  text-align: center; position: relative;background-color:#f6f6f6;padding-top:20px;">'+    	
   	   							'<img src="../../css/img/cartNone.png" style="width:27%;margin: 90px auto 0;">'+
   	   							'<div style="padding: 15px; color: #999;font-size: 17px;">购物车里空空如也<br>去挑几件好货吧！</div></div>');
   	   							// 赋值
   	   		   					isSynRequest = true;
   	   					       	return;
   	   						}
   	   					var shopInfoAllHtml='';
   	   				    $("#hj").show();
 							$("#editAll").show();
   	   					$('input[name="selectAll"]').prop("checked",false); 
   	   					for(var i=0;i<stores.length;i++){
   	   							var html='';
   	   							var shops=stores[i].itemList;
   	   							 html='<div class="shop_goods" id="'+stores[i].storeCode+'" style="padding-bottom: 8px">'+
   	   							 		'<div class="mui-input-row mui-checkbox mui-left">'+
   	   						 				'<form class="itemForm">'+
   	   						 					'<label style="background: #fff;font-size: smaller;">'+stores[i].storeName+'<a href="#" style="float:right;color: #999999;font-size: smaller;"  class="edit">编辑</a></label>'+
   	   						 					'<input name="store"  class="select"  value="'+stores[i].storeCode+'" type="checkbox">';
   	   						 	var shopHtml='';
   	   						 	for(var j=0;j<shops.length;j++){
   	   						 		var shopInfoHtml='';
   	   								var sditShopHtml='';  
   	   								var detailsShophtml='';
   	   						 		shopInfoHtml='<p class="tit" style="font-size: small;">'+shops[j].skuName+'</p>'+
   	   							  				'<input type="hidden" value="'+shops[j].itemId+'" name="ckid"/>'+
   	   											'<div class="price clear">'+
   	   												'<div class="rmb">'+
   	   													'<p style="color: red;"><span>积分：</span><span class="jf">'+shops[j].skuEarnings+'</span></p>'+
   	   												'</div>'+
   	   												'<p class="rule">x<span class="num">'+shops[j].buyAmt+'</span></p>'+
   	   											'</div>';
   	   				 		       sditShopHtml='<div class="chos_num clear">'+
   	   												  '<div style="float: left; width: 78%; padding-top: 21%;">'+
   	   												      '<input type="hidden" value="'+shops[j].skuEarnings+'" name="jf">'+
   	   									                  '<input type="button" value="+" class="jia" style="left:4px"/>'+
   	   									                  '<input type="text"  value="'+shops[j].buyAmt+'" class="exch_num" style="width: 70px;height: 33px;text-align: center;"/>'+
   	   									                  '<input type="button" value="-" class="jian" style="right: 5px;width: 34.19px;"/>'+
   	   								                  '</div>'+
   	   								             	  '<a href="javascript:;" class="dele_goods" style="padding-top: 8%;">'+
   	   													'<i></i>'+
   	   													'<span>删除</span>'+
   	   										   		  '</a>'+
   	   										   		 '<input type="hidden" value="'+shops[j].itemId+'" name="bjid">'+
   	   										   		 '<input type="hidden" value="'+stores[i].storeCode+'" name="storeid">'+
   	   									 	     '</div>';
   								 	 detailsShophtml='<div style="padding-top:5px" id="goods'+shops[j].itemId+'">'+
   	   						 						'<div class="mui-input-row mui-checkbox mui-left">'+
   	   						 							'<input name="goods"  value="'+shops[j].itemId+'" type="checkbox" class="select" style="top:36%">'+
   	   						 							'<div class="clear" style="width: 87%;float: right;padding: 0 10px;">'+
   	   						 								'<div class="detail clear">'+
   	   						 									'<div class="goods_pic" onclick="intoGoodDetail((&#39;'+shops[j].itemId+'&#39;))">'+
   	   						 										'<img src="'+shops[j].imgUrl+'" width="100%" alt="" />'+
   	   						 									'</div>'+
   	   						 									'<div class="goods_con" >'+
   	   							 									'<div id="ck'+shops[j].itemId+'" class="ck" onclick="intoGoodDetail((&#39;'+shops[j].itemId+'&#39;))">'+
   	   							 											shopInfoHtml+
   	   							 									'</div>'+
   	   							 									'<div id="bj'+shops[j].itemId+'" style="display:none" class="bj">'+
   	   							 											sditShopHtml+
   	   							 									'</div>'+
   	   						 									'</div>'+
   	   						 								'</div>'+
   	   						 							'</div>'+
   	   						 						'</div>'+
   	   						 					'</div>';
   	   			 					shopHtml+=detailsShophtml
   	   						 	}
   	   						  html=html+shopHtml+'</form></div></div>';
   	   						  shopInfoAllHtml+=html;
   	   						  
   	   		        	}
   	   					
   	   					$("#shopCat").html(shopInfoAllHtml);
   	   					
   	   				   // 赋值
   	   					isSynRequest = true;
   	   				   /***删除监听事件*/
   	   	   		       $(".dele_goods").on("click",function(){
   	   	                    var _this=this
   	   	                    $("#iosDialog1").css("display","block");
   	   	                    // 点击确定时-------------
   	   	                    $(".weui-dialog__btn_primary").on("click",function(){
   	   	                       // $(_this).parents(".shop_goods").remove();
   	   	                        $("#iosDialog1").css("display","none");
   	   	                        //var id=$(_this).next("input").val();
   	   	                       // alert(id);
   	   	                       var id=$(_this).next("input").val();
   	   	                       var storeId=$(_this).nextAll('input[name="storeid"]').val();
   	   	                       $("#goods"+id).remove();
   	   	                       var goodsLength=$("#"+storeId).find('input[name="goods"]').length;
   	   	                       if(goodsLength==0){
   	   	                    		$("#"+storeId).remove();
   	   	                       }
   	   	                       
   	   	                       var shopsLength=$(this).parents().find(".shop_goods").find('input[name="goods"]').length;
   	   	                       if(shopsLength==0){
   		   	                    	$("#lookshop").append('<div id="noclass" style="width: 100%;  text-align: center; position: relative;background-color:#f6f6f6;padding-top:20px;">'+    	
   		   							'<img src="../../css/img/cartNone.png" style="width:27%;margin: 90px auto 0;">'+
   		   							'<div style="padding: 15px; color: #999;font-size: 17px;">购物车里空空如也<br>去挑几件好货吧！</div></div>');
   		   							$("#hj").hide();
   		   							$("#editAll").hide();   	                       
   	   							}
   	   	                    	ChangeshopCatHtml();
   	   	                    })
   	   	                    // 点击取消时-------------
   	   	                    $(".weui-dialog__btn_default").on("click",function(){
   	   	                        $("#iosDialog1").css("display","none");
   	   	                    })
   	   	                });
   	   	   			   
   	   	   		       /**加减数量监听事件*/
   	   	   			   $('.jia').on('click',function(){
   	   	   	                var n = $(this).siblings('.exch_num').val();
   	   	   	                n++;
   	   	   	                $(this).siblings('.exch_num').val(n);
   	   	   	          		changeBjHtml();
   	   	   	            })
   	   	   	            $('.jian').on('click',function(){
   	   	   	                var n = $(this).siblings('.exch_num').val();
   	   	   	                n--;
   	   	   	                if(n<1){
   	   	   	                    n=1;
   	   	   	                }
   	   	   	                $(this).siblings('.exch_num').val(n);
   	   	   	          		 changeBjHtml();
   	   	   	            });
   	   	                 
   	   	   		       /**商品数量输入改变监听*/
   	   	   		      $(".exch_num").bind('input propertychange',function(){
   	   	   		    	 // alert($(this).val());
   	   	   		    	  if(isNaN($(this).val())){
   	   	   					  if($(this).val()==""){
   	   	   						  return;
   	   	   					  }else{
   	   	   						  $(this).val("");
   	   	   					  }
   	   	   				  }else{
   	   	   					  var num=$(this).val().split(".")[0];
   	   	   					  //alert($(this).val().split("."));
   	   	   					  $(this).val(num);
   	   	   				  }
   	   	   		    	  
   	   	   		      });
   	   	   		      
   	   	   		       /**商品数量输入完成后鼠标移开监听*/
   	   	   			  $(".exch_num").mouseout(function(){
   	   	   				  if($(this).val()==0){
   	   	   					  $(this).val(1);
   	   	   				  }
   	   	   				  if($(this).val()==""){
   	   	   					  $(this).val(1)
   	   	   				  }
   	   	   					changeBjHtml();
   	   	   			  });
   	   	   		      
   	   	   		      /**编辑监听*/
   	   	   		      $(".edit").on('click',function(){
   	   	   		    	  if($(this).html()=="编辑"){
   	   	   		    		  $(this).html("完成");
   	   	   		    		  $(this).parents(".itemForm").find(".ck").each(function(){
   	   	   			    		  var id="";
   	   	   			    		  var num=0;
   	   	   			    		  id=$(this).find('input[name="ckid"]').val();
   	   	   				    	  num=$(this).find(".num").html();
   	   	   				    	  $("#ck"+id).hide();
   	   	   						  $("#bj"+id).find(".exch_num").val(num);
   	   	   						  $("#bj"+id).show();
   	   	   			    	  }); 
   	   	   		    	  }else{
   	   	   		    		  $(this).html("编辑");
   	   	   		    		  $(this).parents(".itemForm").find(".bj").each(function(){
   	   	   			    		  var id="";
   	   	   			    		  var num=0;
   	   	   			    		  id=$(this).find('input[name="bjid"]').val();
   	   	   				    	  num=$(this).find(".exch_num").val();
   	   	   				    	  $("#bj"+id).hide();
   	   	   						  $("#ck"+id).find(".num").html(num);
   	   	   						 //ChangeshopCatHtml();
   	   	   						  $("#ck"+id).show();
   	   	   			    	  }); 
   	   	   		    	  }
   	   	   		      });
   	   	   		    
   	   	   		      /**选择监听*/
   	   	   		      $(".select").on('click',function(){
   	   	   				checkedChange($(this))
   	   	       		  });
  					 }
   				},
   				error:function(result){
   					layer.open({
   						title:'系统提示',
   					    content: '若多次重新加载无效，请关闭当前页面,\n\r 浏览APP其他内容，攻城狮会尽快解决，\n\r给你带来不便，敬请谅解！'
   					    ,btn: ['重新加载', '关闭']
   					    ,yes: function(index){
   					      location.reload();
   					      layer.close(index);
   					    }
   					  });
   				}
   		   });
         }
      
        /**店铺全选或取消全选*/
        function  storeChecked(doumentObj){
	           var checkFlag=true;
	            if(doumentObj.is(':checked')){  
	            	doumentObj.parent().find('input[name="goods"]').each(function(){  
	                    //此处如果用attr，会出现第三次失效的情况  
	                    $(this).prop("checked",true);  
	                }); 
	               
		        }else{  
		        	doumentObj.parent().find('input[name="goods"]').each(function(){  
	                    $(this).removeAttr("checked",false);  
		            });  
		                //$(this).removeAttr("checked");  
		        }
	            var checkedAll=doumentObj.parents().find('input[name="store"]');
	            checkedAll.each(function(){  
                    //此处如果用attr，会出现第三次失效的情况  
                	if($(this).context.checked==false){
                		checkFlag=false;
                    }
                });
	           
	            if(checkFlag){
	            	$('input[name="selectAll"]').prop("checked",true);  
	            }else{
	            	$('input[name="selectAll"]').prop("checked",false);  
	            }
	            //var bjzt= doumentObj.prev().children(".edit").html();
	            ChangeshopCatHtml();
        }
        
		/**单选判断是否全选或1取消全选*/    
		function  goodsChecked(doumentObj){
			 var checkBox=doumentObj.parents(".itemForm").eq(0).find('input[name="goods"]');
			 var checkBoxAll=doumentObj.parents().find('input[name="goods"]');
			 var checkedFlag=true;
			 var checkedAllFlag=true;
			 checkBox.each(function(){ 
				 if($(this).context.checked==false){
					 checkedFlag=false;
				 }
			 });
			 checkBoxAll.each(function(){ 
				 if($(this).context.checked==false){
					 checkedAllFlag=false;
				 }
			 });
			 if(checkedFlag){
				 doumentObj.parents(".itemForm").eq(0).find('input[name="store"]').prop("checked",true);
			 }else{
				 doumentObj.parents(".itemForm").eq(0).find('input[name="store"]').prop("checked",false);
			 }
			 if(checkedAllFlag){
				 $('input[name="selectAll"]').prop("checked",true);
			 }else{
				 $('input[name="selectAll"]').prop("checked",false);
			 }
			 //var bjzt=doumentObj.parents(".itemForm").eq(0).find(".edit").html();
			 ChangeshopCatHtml();
		}
		
		/**所有商品全选或取消全选*/
		function checkedAll(doumentObj){
	           //alert(this.checked);  
	           var checkFlag=true;
	           if(checkFlag){
	           	checkFlag=false;
	            if(doumentObj.is(':checked')){  
	            	doumentObj.parents().find('input').each(function(){  
	                    //此处如果用attr，会出现第三次失效的情况  
	                    $(this).prop("checked",true);  
	                });  
		        }else{  
		        	doumentObj.parents().find('input').each(function(){  
		                    $(this).removeAttr("checked",false);  
		                });  
		                //$(this).removeAttr("checked");  
		        }  
	           }
	           ChangeshopCatHtml();
		} 
		
		 /**选中事件*/
		 function checkedChange(doucment){
			var name=doucment.context.name;
       		if(name=="goods"){
       			goodsChecked(doucment);
       		}else if(name=="store"){
       			storeChecked(doucment);
       		}else{
       			checkedAll(doucment);
       		}
	      }
		
		 /**设置选中的商品总积分数和商品个数*/
		function ChangeshopCatHtml(){
			if($("#editAll").html()==="编辑全部"){
				var obj=getChekedGoods();
		        var zjf=obj.zjf;
		        var num=obj.nums;
		        $("#totalMoney").html(zjf);
		        $(".set_acc_r").html("结算"+"("+num+")");
			}
     		
		}
		
		 
		  /**渲染编辑页面结算积分数额与数量*/
		  function changeBjHtml(){
			  if($("#editAll").html()==="编辑全部"){
				  var obj=getChekedGoods();
				  var zjf=obj.zjf;
		          var num=obj.nums;
		          $("#totalMoney").html(zjf);
		          $(".set_acc_r").html("结算"+"("+num+")");
			  }
		  }
		 
		 
		 /**获取店铺*/
		 function getstores(){
			 var checked=$("#shopCat").find('input[name="stores"]');
		 }
		
	   /*获取选中商品信息*/
		function calcPrice(){
			var checked=$("#shopCat").find('input[name="goods"]');
			var ids=new Array();
			var shopInfos=[];
			var nums=0;
			var zjf=0;
			checked.each(function(){
				if($(this).context.checked==true){
					var id=$(this).context.value;
					var num=$(this).next().find(".num").html();
					var jf=$(this).next().find(".jf").html();
					shopInfos.push({"id":id,"num":Number(num)});
					nums+=Number(num);
					zjf+=Number(jf)*Number(num);
				}
			});
			var obj={shopInfos:shopInfos,nums:nums,zjf:zjf};
			return obj;
		}
		 
		/**获取购物车页面所有商品id和数量*/
		function getShopInfo(){
			var shopInfos=[];
			var nums=0;
			var zjf=0;
			$("#shopCat").find('input[name="goods"]').each(function(){
				var id=$(this).context.value;
				var num=$(this).next().find(".num").html();
				var jf=$(this).next().find(".jf").html();
				shopInfos.push({"id":id,"num":Number(num)});
				nums+=Number(num);
				zjf+=Number(jf)*Number(num);
			});
			var obj={shopInfos:shopInfos,nums:nums,zjf:zjf}
			return obj;
		}
		 
		 /**获取编辑页面所有商品数量*/
	      function getChangeNum(){
	    	    var shopInfos=[];
				var nums=0;
				var zjf=0;  
				$("#shopCat").find('input[name="goods"]').each(function(){
					var id=$(this).next().find('input[name="bjid"]').val();
					var num=$(this).next().find('.exch_num').val();
					var jf=$(this).next().find('input[name="jf"]').val(); 
					shopInfos.push({"id":id,"num":Number(num)});
					nums+=Number(num);
					zjf+=Number(jf)*Number(num);
				});
				var obj={shopInfos:shopInfos,nums:nums,zjf:zjf}
				return obj;
	      }
			
	      /**获取编辑页面选中的商品信息*/
	      function  getCheckedChangeNum(){
	    	  var shopInfos=[];
				var nums=0;
				var zjf=0;  
				$("#shopCat").find('input[name="goods"]').each(function(){
					if($(this).context.checked==true){
						var id=$(this).next().find('input[name="bjid"]').val();
						var num=$(this).next().find('.exch_num').val();
						var jf=$(this).next().find('input[name="jf"]').val(); 
						shopInfos.push({"id":id,"num":Number(num)});
						nums+=Number(num);
						zjf+=Number(jf)*Number(num);
					}
				});
				var obj={shopInfos:shopInfos,nums:nums,zjf:zjf}
				return obj;
	      } 
	
		
	  /**获取所有商品id和数量*/
	  function getGoods(){
		  var shopInfos=[];
			var nums=0;
			var zjf=0;  
			$("#shopCat").find('input[name="goods"]').each(function(){
				var id=$(this).context.value;
				if($(this).next().find("#ck"+id).is(":hidden")){
					var num=$(this).next().find('.exch_num').val();
					var jf=$(this).next().find('input[name="jf"]').val();
					shopInfos.push({"id":id,"num":Number(num)});
					nums+=Number(num);
					zjf+=Number(jf)*Number(num);
				}else{
					var num=$(this).next().find(".num").html();
					var jf=$(this).next().find(".jf").html();
					shopInfos.push({"id":id,"num":Number(num)});
					nums+=Number(num);
					zjf+=Number(jf)*Number(num);
				}
			});
			var obj={shopInfos:shopInfos,nums:nums,zjf:zjf}
			return obj;
	  }
      
	  /***获取选中的商品id和数量*/
	  function getChekedGoods(){
		  var shopInfos=[];
			var nums=0;
			var zjf=0;  
			$("#shopCat").find('input[name="goods"]').each(function(){
				var id=$(this).context.value;
				if($(this).context.checked==true){
					if($(this).next().find("#ck"+id).is(":hidden")){
						var num=$(this).next().find('.exch_num').val();
						var jf=$(this).next().find('input[name="jf"]').val(); 
						shopInfos.push({"id":id,"num":Number(num)});
						nums+=Number(num);
						zjf+=Number(jf)*Number(num);
					}else{
						var num=$(this).next().find(".num").html();
						var jf=$(this).next().find(".jf").html();
						shopInfos.push({"id":id,"num":Number(num)});
						nums+=Number(num);
						zjf+=Number(jf)*Number(num);
					}
				}
			});
			var obj={shopInfos:shopInfos,nums:nums,zjf:zjf}
			return obj;
	  }
		
     
	  /**编辑/完成事件*/
	   function  cz(type){
		  if($("#editAll").html()==="编辑全部"){
			   $("#editAll").html("完成");
			   $("#hjjf").hide();
		       $(".set_acc_r").html("删除");
		       $(".edit").html("完成");
		       $(".edit").hide();
			   changeNum();
		   }else{
			   $("#editAll").html("编辑全部");
			   $(".edit").html("编辑");
			   ChangeNumHtml();
			   ChangeshopCatHtml();
			   $(".edit").show();
			   $("#hjjf").show();
		   }
		   /* queryShopCar(zt); */
	   }

	  /**渲染编辑数量html*/
	  function changeNum(){
		  var obj=getGoods();
		  for(var i=0;i<obj.shopInfos.length;i++){
			  $("#ck"+obj.shopInfos[i].id).hide();
			  $("#bj"+obj.shopInfos[i].id).find(".exch_num").val(obj.shopInfos[i].num);
			  $("#bj"+obj.shopInfos[i].id).show();
		  }
	  }
	  
	  /**渲染编辑完成后页面商品数量*/
	  function ChangeNumHtml(){
		  var obj=getChangeNum();
		  for(var i=0;i<obj.shopInfos.length;i++){
			  $("#bj"+obj.shopInfos[i].id).hide();
			  $("#ck"+obj.shopInfos[i].id).find(".num").html(obj.shopInfos[i].num);
			  $("#ck"+obj.shopInfos[i].id).show();
		  }
	  }
	  
	  
	  
	   
	  
	   /**结算*/
	   function exchangeGoods(){
		   var obj=getChekedGoods();
		   var shopcatNull=false;
		   if($(".set_acc_r").html()=="删除"){
			   if(obj.nums===0){
				   Toast("您还没选择宝贝！",2000);
			   }else{
				   for(var i=0;i<obj.shopInfos.length;i++){
					   $("#goods"+obj.shopInfos[i].id).remove();
				   }
				   $("#shopCat").find('input[name="store"]').each(function(){
					   var goodsLength=0;
					   var goodsLength= $(this).parent().find('input[name="goods"]').length;
					   if(goodsLength==0){
						   $(this).parent().remove();
						   shopcatNull=true;
					   }
				   });
				   if(shopcatNull){
					   $("#lookshop").append('<div id="noclass" style="width: 100%;  text-align: center; position: relative;background-color:#f6f6f6;padding-top:20px;">'+    	
	   							'<img src="../../css/img/cartNone.png" style="width:27%;margin: 90px auto 0;">'+
	   							'<div style="padding: 15px; color: #999;font-size: 17px;">购物车里空空如也<br>去挑几件好货吧！</div></div>');
							$("#hj").hide();
							$("#editAll").hide();  
				   }
			   }
		   }else{
			   if(obj.nums===0){
				   Toast("您还没选择宝贝！",2000);
	        	   return;
			   }else{
				   updateShopCat(1);
				   
			   }
		   }
		  
	   }
	  
	 /**将剩余商品传到后台，对其购物车进行更新*/
	 function updateShopCat(type){
		 if(isSynRequest){
			 var updMallCartJson=[];
			 var dhMallCartJson=[];
			 var data=getChekedGoods().shopInfos;
			 var data1=getGoods().shopInfos;
			 for(var i=0;i<data.length;i++){
				 dhMallCartJson.push({'itemId':data[i].id,'itemNum':data[i].num});
			 }
			 for(var i=0;i<data1.length;i++){
				 updMallCartJson.push({'itemId':data1[i].id,'itemNum':data1[i].num});
			 }
	          $.ajax({
					url : ctx+'/ins/mall/cart/synMallCart',
					//data: {userId:selectContent[0].userId},
					data : {'mallCartJson': JSON.stringify(updMallCartJson)},
					//data:data,
					//contentType: "application/x-www-form-urlencoded", 
					type : "POST",
					traditional : true,
					success : function(result) {
						if(type==1){
							sessionStorage.setItem('ids',JSON.stringify(dhMallCartJson));
							location.href="show_order.html";
						}else{
							window.history.back();
						}
						
					}
	         }); 
		 }
	 }
	 
	 /**回退*/
	 function  fallback(){
		 updateShopCat(2);
	 }
	 /**查看商品详情*/
	 function intoGoodDetail(itemId){
		 updateShopCat(2);
		 location.href="goods_detail.html?id="+itemId;
	 }
	 
	 mui(".mui-bar-nav").on('tap','.mui-icon-left-nav',function(){
		 updateShopCat(2);
	 })
    </script>
</body>
</html>